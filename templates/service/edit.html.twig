{# templates/pack/edit.html.twig #}
{% extends 'baseback.html.twig' %}
{% block css %}
    <link href="{{ asset('plugins/custom/datatables/datatables.bundle.css')}}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('plugins/global/plugins.bundle.css')}}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('css/style.bundle.css')}}" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" type="image/png" href="{{ asset('media/logos/alphalogo.png')}}" />
    <link rel="stylesheet" href="{{ asset('css/styles.min.css')}}" />
{% endblock %}

{% block bodyback %}
        <!--end::Header container-->
    <div class="card mb-5 mb-xl-8">
        <!--begin::Header-->
        <div class="card-header border-0 pt-5" style="margin-top: 50px">
            <h3 class="card-title align-items-start flex-column">
                <span class="card-title fw-semibold">Users List</span>

            </h3>

            <!--begin::Add user-->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_add_user">
                <!--begin::Svg Icon | path: icons/duotune/arrows/arr075.svg-->
                <span class="svg-icon svg-icon-2">
    														<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    															<rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />
    															<rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />
    														</svg>
    													</span>
                <!--end::Svg Icon-->Add</button>
            <!--end::Add user-->
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body py-3" >
            <!--begin::Table container-->
            <div class="table-responsive">
                <!--begin::Table-->
                <table class="table align-middle gs-0 gy-4">
                    <!--begin::Table head-->
                    <thead>
                    <tr class="fw-bold text-white  " style="background-color: #009EF7">
                        <th class="ps-4 min-w-100px rounded-start">Last Name</th>
                        <th class="min-w-125px">First Name</th>
                        <th class="min-w-125px">Location</th>
                        <th class="min-w-200px">Email</th>
                        <th class="min-w-200px">Role</th>
                        <th class="min-w-200px text-center rounded-end">Actions</th>
                    </tr>
                    </thead>
                    <!--end::Table head-->
                    <!--begin::Table body-->
                    <tbody>
                    
                    </tbody>
                    <!--end::Table body-->
                </table>
                <!--end::Table-->

            </div>
            <!--end::Table container-->

        </div>
        <!-- Modal -->
        <!--begin::Modal - Add task-->
        <div class="modal fade" id="kt_modal_add_user" tabindex="-1" aria-hidden="true">
            <!--begin::Modal dialog-->
            <div class="modal-dialog modal-dialog-centered mw-650px">
                <!--begin::Modal content-->
                <div class="modal-content">
                    <!--begin::Modal header-->
                    <div class="modal-header" id="kt_modal_add_user_header">
                        <!--begin::Modal title-->
                        <h2 class="fw-bold">Add User</h2>
                        <!--end::Modal title-->

                    </div>
                    <!--end::Modal header-->
                    <!--begin::Modal body-->
                    <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                        <form class="form w-100" id="kt_sign_up_form" action="{{ path('edit_pack', {'id': pack.id}) }}" method="post">
 
                            {{ form_row(form.nom) }}
                            {{ form_row(form.prix) }}
                            {{ form_row(form.description) }}
                            <div class="horizontal-checkboxes">
                                {{ form_widget(form.service) }}
                            </div>
                            

                            <button type="submit">Update</button>
                        </form>
                    </div>
                    <!--end::Modal body-->
                </div>
                <!--end::Modal content-->
            </div>
            <!--end::Modal dialog-->
        </div>
        <!--end::Modal - Add task-->
        <!--begin::Body-->
        <!-- Edit Profile Modal -->
        <div class="modal fade" id="AddUserModal" tabindex="-1" aria-labelledby="AddUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="AddUserModalLabel">Edit Profile</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body with the form -->
                    <div class="modal-body">
                        <span id="userId"></span>

                        <form method="post" action="{{ path('admin_update', {'id': 0}) }}" id="editUserForm">

                            <input type="text" id="adminreg_nom" name="adminreg[nom]" class="form-control" value="" />
                            <input type="text" id="adminreg_prenom" name="adminreg[prenom]" class="form-control" placeholder="First Name" />
                            <input type="text" id="adminreg_adresse" name="adminreg[adresse]" class="form-control" placeholder="Address" />
                            <input type="text" id="adminreg_email" name="adminreg[email]" class="form-control" placeholder="Email" />
                            <input type="password" id="adminreg_password" name="adminreg[password]" class="form-control" placeholder="Password" />
                            <input type="text" id="adminreg_salaire" name="adminreg[salaire]" class="form-control" placeholder="Salaire" />
                            <button type="submit" class="btn btn-primary">Save</button>
                            {{ csrf_token('admin_update') }}
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block jsback %}
    <script src="{{ asset('/plugins/global/plugins.bundle.js')}}"></script>
    <script src="{{ asset('/js/scripts.bundle.js')}}"></script>
    <!--end::Global Javascript Bundle-->

    <!--begin::Custom Javascript(used for this page only)-->
    <script src="{{ asset('/js/custom/landing.js')}}"></script>
    <script src="{{ asset('js/custom/pages/pricing/general.js')}}"></script>
    <!--begin::Vendors Javascript(used for this page only)-->
    <script src="{{ asset('plugins/custom/datatables/datatables.bundle.js')}}"></script>
    <!--end::Vendors Javascript-->
    <!--begin::Custom Javascript(used for this page only)-->
    <script src="{{ asset('js/custom/pages/user-profile/general.js')}}"></script>
    <script src="{{ asset('js/widgets.bundle.js')}}"></script>
    <script src="{{ asset('js/custom/widgets.js')}}"></script>
    <script src="{{ asset('js/custom/apps/chat/chat.js')}}"></script>
    <script src="{{ asset('js/custom/utilities/modals/upgrade-plan.js')}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const editButtons = document.querySelectorAll('.edit-user');
                const form = document.getElementById('editUserForm');
                const modal = new bootstrap.Modal(document.getElementById('AddUserModal'));
                editButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const userId = this.getAttribute('data-user-id');

                        // Update the form action with the user ID
                        form.action = "{{ path('admin_update', {'id': 0})|raw }}".replace('0', userId);

                        // Optionally, you can display the user ID in the modal
                        document.getElementById('userId').innerText = 'User ID: ' + userId;

                        // Fetch user details via AJAX
                        fetch("{{ path('get_user_details', {'id': 0})|raw }}".replace('0', userId), {
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                            },
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data); // Check if data is received properly
                                // Update form fields with user details
                                form.querySelector('#adminreg_nom').value = data.nom;
                                form.querySelector('#adminreg_prenom').value = data.prenom;
                                form.querySelector('#adminreg_adresse').value = data.adresse;
                                form.querySelector('#adminreg_email').value = data.email;
                                form.querySelector('#adminreg_password').value = data.password; // Clear the password field
                                form.querySelector('#adminreg_salaire').value = data.salaire;
                                // Note: Adjust the field names based on your Symfony form structure
                            })
                            .catch(error => console.error('Error fetching user details:', error));

                        // Attach form submission handler
                        form.addEventListener('submit', function (event) {
                            event.preventDefault(); // Prevent the default form submission
                            // You can add additional validation or confirmation logic here if needed

                            // Create a FormData object and append the CSRF token
                            const formData = new FormData(form);
                            formData.append('{{ csrf_token('admin_update') }}', '1'); // Replace '1' with your actual CSRF token

                            // Submit the form
                            fetch(form.action, {
                                method: 'POST',
                                body: formData,
                            })
                                .then(response => {
                                    if (response.ok) {
                                        console.log('Form submitted successfully!');
                                        modal.hide();// Optionally, you can perform additional actions after successful form submission
                                        location.reload();
                                    } else {
                                        console.error('Form submission failed.');
                                    }
                                })
                                .catch(error => console.error('Error submitting form:', error));
                        });
                    });
                });
            });

        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var radioButtons = document.querySelectorAll('.role-radio-buttons input[type="radio"]');

                radioButtons.forEach(function (radioButton) {
                    radioButton.addEventListener('change', function () {
                        if (radioButton.checked) {
                            radioButtons.forEach(function (otherRadioButton) {
                                if (otherRadioButton !== radioButton) {
                                    otherRadioButton.checked = false;
                                }
                            });
                        }
                    });
                });
            });

        </script>
    <script src="{{ asset('libs/jquery/dist/jquery.min.js')}}"></script>
    <script src="{{ asset('libs/bootstrap/dist/js/bootstrap.bundle.min.js')}}"></script>
    <script src="{{ asset('js/sidebarmenu.js')}}"></script>
    <script src=".{{ asset('js/app.min.js')}}"></script>
    <script src="{{ asset('libs/apexcharts/dist/apexcharts.min.js')}}"></script>
    <script src="{{ asset('libs/simplebar/dist/simplebar.js')}}"></script>
    <script src="{{ asset('js/dashboard.js')}}"></script>
{% endblock %}
